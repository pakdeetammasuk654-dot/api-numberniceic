<div class="card">
    <h1 class="text-center">üîç ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏á‡∏Ñ‡∏•</h1>
    <form action="/analysis" method="POST">
        <label><strong>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</strong></label>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">

            <input type="text" name="name" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)" required value="{{if .Name}}{{.Name}}{{end}}" style="flex: 2; min-width: 200px; margin: 0;">

            <select name="birth_day" class="form-control" style="flex: 1; min-width: 150px; margin: 0;" required>
                <option value="" disabled {{if not .BirthDay}}selected{{end}}>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î --</option>
                <option value="sunday" {{if eq .BirthDay "sunday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</option>
                <option value="monday" {{if eq .BirthDay "monday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</option>
                <option value="tuesday" {{if eq .BirthDay "tuesday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</option>
                <option value="wednesday1" {{if eq .BirthDay "wednesday1"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò (‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô)</option>
                <option value="wednesday2" {{if eq .BirthDay "wednesday2"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò (‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô)</option>
                <option value="thursday" {{if eq .BirthDay "thursday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</option>
                <option value="friday" {{if eq .BirthDay "friday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå</option>
                <option value="saturday" {{if eq .BirthDay "saturday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå</option>
            </select>

            <button type="submit" class="btn btn-success" style="width: auto; padding: 0 20px;">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</button>
        </div>
    </form>
</div>

{{if .Error}}
    <div class="text-center text-danger mt-3" style="background: #ffebee; padding: 10px; border-radius: 5px;">
        ‚ö†Ô∏è {{.Error}}
    </div>
{{end}}

{{if .Result}}

    {{if .Result.HasKakis}}
        <div style="background-color: #ffebee; color: #c62828; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ef9a9a; display: flex; align-items: flex-start; gap: 15px;">
            <div style="font-size: 2rem;">‚ö†Ô∏è</div>
            <div>
                <h3 style="margin: 0; color: #b71c1c;">‡∏û‡∏ö‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ!</h3>
                <p style="margin: 5px 0 0 0;">
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:
                    {{range .Result.KakisFound}}
                        <span class="badge" style="background: #c62828; color: white; font-size: 1rem; margin: 0 2px;">{{.}}</span>
                    {{end}}
                    <br><small style="color: #d32f2f;">(‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á)</small>
                </p>
            </div>
        </div>
    {{else}}
        <div style="background-color: #e8f5e9; color: #2e7d32; padding: 12px; border-radius: 8px; margin-bottom: 20px; text-align: center; border: 1px solid #a5d6a7;">
            ‚úÖ <strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢!</strong> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        </div>
    {{end}}

    <div class="visual-section">
        <h3 style="margin-top: 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 10px;">
            üîÆ ‡∏Ç‡∏∏‡∏°‡∏û‡∏•‡∏±‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        </h3>

        <div class="pair-row" style="justify-content: center; gap: 15px; padding-top: 10px;">

            {{range .Result.SatPairs}}
                <div class="pair-circle {{if .Meaning}}type-{{.Meaning.PairType}}{{end}}"
                     title="‡πÄ‡∏•‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå: {{if .Meaning}}{{.Meaning.MiracleDesc}} ({{.Meaning.PairPoint}}){{end}}">
                    {{.Pair}}
                </div>
            {{end}}

            {{range .Result.ShaPairs}}
                <div class="pair-circle {{if .Meaning}}type-{{.Meaning.PairType}}{{end}}"
                     title="‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏á‡∏≤: {{if .Meaning}}{{.Meaning.MiracleDesc}} ({{.Meaning.PairPoint}}){{end}}">
                    {{.Pair}}
                </div>
            {{end}}

        </div>

        <p style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: #777;">
            <span style="display: inline-block; width: 10px; height: 10px; background: #2e7d32; border-radius: 50%;"></span> ‡πÄ‡∏Å‡∏£‡∏î‡∏î‡∏µ
            &nbsp;&nbsp;
            <span style="display: inline-block; width: 10px; height: 10px; background: #c62828; border-radius: 50%;"></span> ‡πÄ‡∏Å‡∏£‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á
        </p>
    </div>

    <div class="summary-box">
        <h3 style="color: #555; margin: 0;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏ß‡∏°</h3>

        <div id="totalScore" class="total-score-big" data-target="{{.Result.TotalScore}}">0</div>

        <div class="sub-score-container">
            <div class="score-badge score-good">
                ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ: +<span id="goodScore" data-target="{{.Result.GoodScore}}">0</span>
            </div>
            <div class="score-badge score-bad">
                ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡πâ‡∏≤‡∏¢: <span id="badScore" data-target="{{.Result.BadScore}}">0</span>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 class="header-line">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢: {{.Result.Name}}</h2>

        <div class="result-container">
            <div class="result-col">
                <h3 style="color: #0277bd;">üßÆ ‡πÄ‡∏•‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h3>
                <p>‡∏ú‡∏•‡∏£‡∏ß‡∏°: <strong>{{.Result.SatSum}}</strong></p>

                {{range .Result.SatPairs}}
                    <div class="pair-card {{if .Meaning}}type-{{.Meaning.PairType}}{{end}}" style="padding: 15px; margin-bottom: 15px; border-radius: 4px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                        <div style="display: flex; align-items: flex-start;">
                            <div style="margin-right: 15px; text-align: center; min-width: 50px;">
                                <span class="pair-number" style="font-size: 1.8rem; font-weight: bold; color: #333;">{{.Pair}}</span>
                                {{if .Meaning}}
                                    <br><span style="font-size: 0.8rem; padding: 2px 6px; background: #eee; border-radius: 4px; color: #666;">{{.Meaning.PairType}}</span>
                                {{end}}
                            </div>
                            <div>
                                {{if .Meaning}}
                                    <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 5px;">{{.Meaning.MiracleDesc}}</div>
                                    <small style="color: #666; display: block; margin-bottom: 8px;">{{.Meaning.MiracleDetail}}</small>
                                    <span class="badge" style="background: rgba(0,0,0,0.05); color: #333; font-weight: bold;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: {{.Meaning.PairPoint}}</span>
                                {{else}}
                                    <span style="color: #999;">- ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ -</span>
                                {{end}}
                            </div>
                        </div>
                    </div>
                {{end}}
            </div>

            <div class="result-col">
                <h3 style="color: #7b1fa2;">üåë ‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏á‡∏≤</h3>
                <p>‡∏ú‡∏•‡∏£‡∏ß‡∏°: <strong>{{.Result.ShaSum}}</strong></p>

                {{range .Result.ShaPairs}}
                    <div class="pair-card {{if .Meaning}}type-{{.Meaning.PairType}}{{end}}" style="padding: 15px; margin-bottom: 15px; border-radius: 4px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                        <div style="display: flex; align-items: flex-start;">
                            <div style="margin-right: 15px; text-align: center; min-width: 50px;">
                                <span class="pair-number" style="font-size: 1.8rem; font-weight: bold; color: #333;">{{.Pair}}</span>
                                {{if .Meaning}}
                                    <br><span style="font-size: 0.8rem; padding: 2px 6px; background: #eee; border-radius: 4px; color: #666;">{{.Meaning.PairType}}</span>
                                {{end}}
                            </div>
                            <div>
                                {{if .Meaning}}
                                    <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 5px;">{{.Meaning.MiracleDesc}}</div>
                                    <small style="color: #666; display: block; margin-bottom: 8px;">{{.Meaning.MiracleDetail}}</small>
                                    <span class="badge" style="background: rgba(0,0,0,0.05); color: #333; font-weight: bold;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: {{.Meaning.PairPoint}}</span>
                                {{else}}
                                    <span style="color: #999;">- ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ -</span>
                                {{end}}
                            </div>
                        </div>
                    </div>
                {{end}}
            </div>
        </div>
    </div>
{{end}}

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const counters = [
            document.getElementById('totalScore'),
            document.getElementById('goodScore'),
            document.getElementById('badScore')
        ];

        counters.forEach(counter => {
            if (!counter) return;

            const target = parseInt(counter.getAttribute('data-target'), 10) || 0;
            const duration = 2000;
            const start = 0;
            const startTime = performance.now();

            function updateCount(currentTime) {
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);
                const easeProgress = (progress === 1) ? 1 : 1 - Math.pow(2, -10 * progress);
                const current = Math.floor(easeProgress * (target - start) + start);

                counter.innerText = current;

                if (progress < 1) {
                    requestAnimationFrame(updateCount);
                } else {
                    counter.innerText = target;
                }
            }

            requestAnimationFrame(updateCount);
        });
    });
</script>