<link rel="stylesheet" href="/static/analysis.css">

<div class="card" style="padding-top: 30px; padding-bottom: 30px;">
    <form action="/analysis" method="POST" class="analysis-form">
        <div style="display: flex; flex-direction: column; gap: 20px; max-width: 600px; margin: 0 auto;">
            <div class="input-wrapper select-wrapper">
                <span class="input-icon">üìÖ</span>
                <select name="birth_day" class="form-control-custom" required onchange="this.form.submit()">
                    <option value="" disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î --</option>
                    <option value="sunday" {{if or (eq .BirthDay "sunday") (not .BirthDay)}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</option>
                    <option value="monday" {{if eq .BirthDay "monday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</option>
                    <option value="tuesday" {{if eq .BirthDay "tuesday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</option>
                    <option value="wednesday1" {{if eq .BirthDay "wednesday1"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò (‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô)</option>
                    <option value="wednesday2" {{if eq .BirthDay "wednesday2"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò (‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô)</option>
                    <option value="thursday" {{if eq .BirthDay "thursday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</option>
                    <option value="friday" {{if eq .BirthDay "friday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå</option>
                    <option value="saturday" {{if eq .BirthDay "saturday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå</option>
                </select>
            </div>
            <div class="input-wrapper">
                <span class="input-icon">üë§</span>
                <input type="text" id="nameInput" name="name" class="form-control-custom" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...)" required maxlength="24" autocomplete="off" value="{{if .Name}}{{.Name}}{{else}}‡∏ì‡πÄ‡∏î‡∏ä‡∏ì‡πå{{end}}" style="padding-right: 40px;">
                <button type="button" id="clearInputBtn" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); border: none; background: none; color: #aaa; font-size: 1.2rem; cursor: pointer; padding: 0; line-height: 1; display: none;">&times;</button>
            </div>
            <div id="typingStatus" style="text-align: center; color: #888; font-size: 0.9rem; display: none; margin-top: -10px;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏™‡∏£‡πá‡∏à...</div>
        </div>
    </form>
</div>

<div class="sample-section" style="margin-bottom: 30px;">
    <p class="sample-title" style="text-align: center; margin-top: 0;">üí° ‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à</p>
    <div class="sample-grid">
        <div class="sample-item" data-name="‡∏ì‡πÄ‡∏î‡∏ä‡∏ô‡πå"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Nadech"><span>‡∏ì‡πÄ‡∏î‡∏ä‡∏ô‡πå</span></div>
        <div class="sample-item" data-name="‡∏†‡∏π‡∏î‡∏¥‡∏ó"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Phudit"><span>‡∏†‡∏π‡∏î‡∏¥‡∏ó</span></div>
        <div class="sample-item" data-name="‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Jirayu"><span>‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏</span></div>
        <div class="sample-item" data-name="‡∏õ‡∏±‡∏ç‡∏ç‡∏≤"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Panya"><span>‡∏õ‡∏±‡∏ç‡∏ç‡∏≤</span></div>
        <div class="sample-item" data-name="‡∏°‡∏ô‡∏±‡∏™‡∏™‡∏¥‡∏¢‡∏≤"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Manassiya"><span>‡∏°‡∏ô‡∏±‡∏™‡∏™‡∏¥‡∏¢‡∏≤</span></div>
        <div class="sample-item" data-name="‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Baitoey"><span>‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢</span></div>
        <div class="sample-item" data-name="‡πÄ‡∏ß‡∏¨‡∏≤"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Vela"><span>‡πÄ‡∏ß‡∏¨‡∏≤</span></div>
        <div class="sample-item" data-name="‡∏ß‡∏¥‡∏Å‡∏£‡∏°"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Vikrom"><span>‡∏ß‡∏¥‡∏Å‡∏£‡∏°</span></div>
        <div class="sample-item" data-name="‡∏≠‡∏±‡∏®‡∏ß‡πÇ‡∏†‡∏Ñ‡∏¥‡∏ô"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Assavaphokin"><span>‡∏≠‡∏±‡∏®‡∏ß‡πÇ‡∏†‡∏Ñ‡∏¥‡∏ô</span></div>
        <div class="sample-item" data-name="‡∏•‡∏≥‡πÑ‡∏¢"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Lamyai"><span>‡∏•‡∏≥‡πÑ‡∏¢</span></div>
        <div class="sample-item" data-name="‡πÄ‡∏™‡∏Å‡πÇ‡∏•‡πÇ‡∏ã"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=SekLoso"><span>‡πÄ‡∏™‡∏Å‡πÇ‡∏•‡πÇ‡∏ã</span></div>
        <div class="sample-item" data-name="‡∏ô‡∏¥‡∏ß‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Newclear"><span>‡∏ô‡∏¥‡∏ß‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</span></div>
    </div>
</div>

{{if .Error}}
    <div class="text-center text-danger mt-3" style="background: #ffebee; padding: 10px; border-radius: 5px;">‚ö†Ô∏è {{.Error}}</div>
{{end}}

{{if .Result}}
    <div id="analysisData"
         data-name="{{.Result.Name}}"
         data-kakis="{{if .Result.KakisFound}}{{range $i, $e := .Result.KakisFound}}{{if $i}},{{end}}{{$e}}{{end}}{{end}}"
         style="display: none;">
    </div>

    <div class="summary-box">
        <button class="btn-save-solar" onclick="alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! (Demo)')">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠</button>
        <div class="summary-row">
            <div class="score-panel">
                <div class="score-item"><div class="score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div><div class="score-value-big {{if lt .Result.TotalScore 0}}bg-bad{{else}}bg-good{{end}}" id="totalScore" data-target="{{.Result.TotalScore}}">0</div></div>
                <div class="divider"></div>
                <div class="score-item"><div class="score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ</div><div class="score-value-small val-good">+<span id="goodScore" data-target="{{.Result.GoodScore}}">0</span></div></div>
                <div class="score-item"><div class="score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡πâ‡∏≤‡∏¢</div><div class="score-value-small val-bad"><span id="badScore" data-target="{{.Result.BadScore}}">0</span></div></div>
            </div>
            <div class="galaxy-wrapper">
                <div class="solar-system">
                    <div class="orbit-ring ring-middle">
                        {{range $i, $el := .Result.ShaPairs}}{{if lt $i 5}}<div class="planet-wrapper pos-mid-{{$i}}"><div class="mini-star {{if .Meaning}}type-{{.Meaning.PairType}}{{else}}star-sha{{end}} c-spin-middle">{{.Pair}}</div></div>{{end}}{{end}}
                    </div>
                    <div class="orbit-ring ring-outer">
                        {{range $i, $el := .Result.SatPairs}}{{if lt $i 6}}<div class="planet-wrapper pos-out-{{$i}}"><div class="mini-star {{if .Meaning}}type-{{.Meaning.PairType}}{{else}}star-sat{{end}} c-spin-outer">{{.Pair}}</div></div>{{end}}{{end}}
                    </div>
                    <div class="score-circle {{if lt .Result.TotalScore 0}}sun-bad{{else}}sun-good{{end}}"><span id="sunNameDisplay"></span></div>
                </div>
            </div>
            <div class="right-column">
                <div class="kakis-box">
                    {{if .Result.HasKakis}}
                        <div style="color: #555; font-size: 0.9rem; background: rgba(255,255,255,0.9); padding: 8px 15px; border-radius: 20px; display: inline-block; border: 1px solid #ef9a9a; box-shadow: 0 2px 5px rgba(0,0,0,0.05);"><span style="color: #d32f2f;">‚óè</span> ‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è<span style="color: #d32f2f; font-weight: bold;">‡∏™‡∏µ‡πÅ‡∏î‡∏á</span>‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ</div>
                    {{else}}
                        <div class="speech-bubble-success">üèÜ ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ</div>
                    {{end}}
                </div>
                <div class="action-frame">
                    <button id="btnShowDetails" class="btn-action btn-sat" style="border:none; font-family:inherit; cursor:pointer;">üßÆ ‡πÄ‡∏•‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</button>
                    <button id="btnLinguistics" class="btn-action btn-lang" style="border:none; font-family:inherit; cursor:pointer;">üìú ‡∏†‡∏≤‡∏©‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</button>
                    <div class="action-desc">üí° ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢</div>
                </div>
            </div>
        </div>
    </div>

    <div id="detailSection" class="card" style="display: none; position: relative;">
        <button id="btnCloseDetails" title="‡∏õ‡∏¥‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">&times;</button>
        <h2 class="header-line">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢: {{.Result.Name}}</h2>
        <div class="result-container">
            <div class="result-col" id="sat-section">
                <h3 style="color: #0277bd;">üßÆ ‡πÄ‡∏•‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h3>
                <p>‡∏ú‡∏•‡∏£‡∏ß‡∏°: <strong>{{.Result.SatSum}}</strong></p>
                {{range .Result.SatPairs}}
                    <div class="pair-card {{if .Meaning}}type-{{.Meaning.PairType}}{{end}}">
                        <div style="display: flex; align-items: flex-start;">
                            <div style="margin-right: 15px; text-align: center; min-width: 50px;"><span class="pair-number">{{.Pair}}</span>{{if .Meaning}}<br><span style="font-size: 0.8rem; padding: 2px 6px; background: #eee; border-radius: 4px; color: #666;">{{.Meaning.PairType}}</span>{{end}}</div>
                            <div>{{if .Meaning}}<div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 5px;">{{.Meaning.MiracleDesc}}</div><small style="color: #666;">{{.Meaning.MiracleDetail}}</small>{{else}}<span style="color: #999;">- ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -</span>{{end}}</div>
                        </div>
                    </div>
                {{end}}
            </div>
            <div class="result-col" id="sha-section">
                <h3 style="color: #7b1fa2;">üåë ‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏á‡∏≤</h3>
                <p>‡∏ú‡∏•‡∏£‡∏ß‡∏°: <strong>{{.Result.ShaSum}}</strong></p>
                {{range .Result.ShaPairs}}
                    <div class="pair-card {{if .Meaning}}type-{{.Meaning.PairType}}{{end}}">
                        <div style="display: flex; align-items: flex-start;">
                            <div style="margin-right: 15px; text-align: center; min-width: 50px;"><span class="pair-number">{{.Pair}}</span>{{if .Meaning}}<br><span style="font-size: 0.8rem; padding: 2px 6px; background: #eee; border-radius: 4px; color: #666;">{{.Meaning.PairType}}</span>{{end}}</div>
                            <div>{{if .Meaning}}<div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 5px;">{{.Meaning.MiracleDesc}}</div><small style="color: #666;">{{.Meaning.MiracleDetail}}</small>{{else}}<span style="color: #999;">- ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -</span>{{end}}</div>
                        </div>
                    </div>
                {{end}}
            </div>
        </div>
    </div>

    <div class="card">
        <h3 class="header-line">
            üåü ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á <span id="similarNameDisplay" style="color: #007bff; margin-left: 5px;"></span>
        </h3>
        <div class="table-responsive">
            {{if .Result.SimilarNames}}
                <table class="table table-hover table-striped align-middle" style="margin-bottom: 0; width: 100%; border-collapse: collapse;">
                    <thead class="table-light">
                    <tr><th scope="col" style="padding: 12px;">‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏á‡∏Ñ‡∏•</th><th scope="col" class="text-center">‡πÄ‡∏•‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</th><th scope="col" class="text-center">‡πÄ‡∏•‡∏Ç‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏á‡∏≤</th><th scope="col" class="text-center">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡πà‡∏≤‡∏á</th></tr>
                    </thead>
                    <tbody>
                    {{range .Result.SimilarNames}}
                        <tr onclick="window.location.href='/analysis?name={{.ThName}}&birth_day={{$.BirthDay}}'">
                            <td style="font-size: 1.1rem; font-weight: bold; color: #333; padding: 12px;">{{.ThName}}</td>
                            <td class="text-center"><div style="display: flex; justify-content: center; gap: 4px; flex-wrap: wrap;">{{range .SatPairs}}<div class="mini-star-table {{if .Meaning}}type-{{.Meaning.PairType}}{{else}}star-sat{{end}}">{{.Pair}}</div>{{end}}</div></td>
                            <td class="text-center"><div style="display: flex; justify-content: center; gap: 4px; flex-wrap: wrap;">{{range .ShaPairs}}<div class="mini-star-table {{if .Meaning}}type-{{.Meaning.PairType}}{{else}}star-sha{{end}}">{{.Pair}}</div>{{end}}</div></td>
                            <td class="text-center"><span style="font-size: 0.9rem; color: #666;">{{printf "%.3f" .Distance}}</span></td>
                        </tr>
                    {{end}}
                    </tbody>
                </table>
            {{else}}
                <p class="text-center text-muted p-3">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
            {{end}}
        </div>
    </div>
{{end}}

<div id="aiModal" class="ai-modal">
    <div class="ai-modal-content">
        <span class="close-modal">&times;</span>
        <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0;">ü§ñ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏Å‡∏®‡∏±‡∏û‡∏ó‡πå (AI)</h3>
        <div id="aiContent" style="line-height: 1.6; color: #444;"></div>
    </div>
</div>

<script src="/static/analysis.js"></script>