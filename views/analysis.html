<style>
    /* --- 1. ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Zebra & Clickable) --- */
    .table-striped tbody tr:nth-of-type(odd) { background-color: #f9f9f9; }
    .table-striped tbody tr:nth-of-type(even) { background-color: #ffffff; }

    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏ñ‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏°‡∏µ Effect */
    .table-hover tbody tr {
        cursor: pointer;
        transition: background-color 0.2s, transform 0.1s;
    }
    .table-hover tbody tr:hover {
        background-color: #e3f2fd !important;
        transform: scale(1.005); /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏µ‡πâ */
    }

    /* --- 2. ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á --- */
    .mini-star-table {
        width: 32px; height: 32px; font-size: 0.85rem;
        display: flex; justify-content: center; align-items: center;
        border-radius: 50%; color: white; font-weight: bold;
        box-shadow: 0 2px 4px rgba(0,0,0,0.15); cursor: default;
        text-shadow: 0 1px 1px rgba(0,0,0,0.2);
    }

    /* --- 3. ‡πÄ‡∏â‡∏î‡∏™‡∏µ‡∏ß‡∏á‡∏Å‡∏•‡∏° (D/R Logic) --- */
    .mini-star-table.type-D10, .mini-star-table.type-d10 { background: linear-gradient(135deg, #1b5e20, #2e7d32); box-shadow: 0 0 5px rgba(27, 94, 32, 0.5); }
    .mini-star-table.type-D8, .mini-star-table.type-d8   { background: linear-gradient(135deg, #2e7d32, #43a047); }
    .mini-star-table.type-D5, .mini-star-table.type-d5   { background: linear-gradient(135deg, #43a047, #66bb6a); }
    .mini-star-table[class*="type-D"]                    { background: linear-gradient(135deg, #4caf50, #81c784); }
    .mini-star-table.type-R10, .mini-star-table.type-r10 { background: linear-gradient(135deg, #b71c1c, #c62828); box-shadow: 0 0 5px rgba(183, 28, 28, 0.5); }
    .mini-star-table.type-R7, .mini-star-table.type-r7   { background: linear-gradient(135deg, #c62828, #d32f2f); }
    .mini-star-table.type-R5, .mini-star-table.type-r5   { background: linear-gradient(135deg, #d32f2f, #ef5350); }
    .mini-star-table[class*="type-R"]                    { background: linear-gradient(135deg, #ef5350, #e57373); }
    .mini-star-table.star-sat { background: linear-gradient(135deg, #42a5f5, #1976d2); }
    .mini-star-table.star-sha { background: linear-gradient(135deg, #ab47bc, #7b1fa2); }

    /* --- 4. Input Style (Custom with Icon) --- */
    .input-wrapper {
        position: relative;
        width: 100%;
    }
    .input-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.2rem;
        color: #888;
        pointer-events: none; /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏õ‡∏ó‡∏µ‡πà input ‡πÑ‡∏î‡πâ */
        z-index: 5;
    }
    .form-control-custom {
        width: 100%;
        padding: 12px 15px 12px 45px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô */
        font-size: 1.1rem;
        border: 1px solid #ddd;
        border-radius: 10px;
        box-sizing: border-box;
        transition: all 0.3s;
        background-color: #fff;
        appearance: none; /* ‡∏•‡∏ö style default ‡∏Ç‡∏≠‡∏á select */
    }
    .form-control-custom:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 4px rgba(0,123,255,0.1);
        outline: none;
    }
    /* ‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Select (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ appearance:none ‡∏à‡∏∞‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏≠‡∏≠‡∏Å) */
    .select-wrapper::after {
        content: "‚ñº";
        font-size: 0.8rem;
        color: #888;
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
    }
</style>

<div class="card" style="padding-top: 30px; padding-bottom: 30px;">
    <form action="/analysis" method="POST" class="analysis-form">
        <div style="display: flex; flex-direction: column; gap: 20px; max-width: 600px; margin: 0 auto;">

            <div class="input-wrapper select-wrapper">
                <span class="input-icon">üìÖ</span>
                <select name="birth_day" class="form-control-custom" required onchange="this.form.submit()">
                    <option value="" disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î --</option>
                    <option value="sunday" {{if or (eq .BirthDay "sunday") (not .BirthDay)}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</option>
                    <option value="monday" {{if eq .BirthDay "monday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</option>
                    <option value="tuesday" {{if eq .BirthDay "tuesday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</option>
                    <option value="wednesday1" {{if eq .BirthDay "wednesday1"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò (‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô)</option>
                    <option value="wednesday2" {{if eq .BirthDay "wednesday2"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò (‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô)</option>
                    <option value="thursday" {{if eq .BirthDay "thursday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</option>
                    <option value="friday" {{if eq .BirthDay "friday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå</option>
                    <option value="saturday" {{if eq .BirthDay "saturday"}}selected{{end}}>‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå</option>
                </select>
            </div>

            <div class="input-wrapper">
                <span class="input-icon">üë§</span>
                <input type="text" id="nameInput" name="name" class="form-control-custom"
                       placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...)" required
                       maxlength="24" autocomplete="off"
                       value="{{if .Name}}{{.Name}}{{else}}‡∏ì‡πÄ‡∏î‡∏ä‡∏ì‡πå{{end}}"
                       style="padding-right: 40px;"> <button type="button" id="clearInputBtn"
                                                             style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
                               border: none; background: none; color: #aaa; font-size: 1.2rem;
                               cursor: pointer; padding: 0; line-height: 1; display: none;">
                    &times;
                </button>
            </div>

            <div id="typingStatus" style="text-align: center; color: #888; font-size: 0.9rem; display: none; margin-top: -10px;">
                ‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏™‡∏£‡πá‡∏à...
            </div>
        </div>
    </form>
</div>

<div class="sample-section" style="margin-bottom: 30px;">
    <p class="sample-title" style="text-align: center; margin-top: 0;">
        üí° ‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à
    </p>

    <div class="sample-grid">
        <div class="sample-item" data-name="‡∏ì‡πÄ‡∏î‡∏ä‡∏ô‡πå"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Nadech"><span>‡∏ì‡πÄ‡∏î‡∏ä‡∏ô‡πå</span></div>
        <div class="sample-item" data-name="‡∏†‡∏π‡∏î‡∏¥‡∏ó"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Phudit"><span>‡∏†‡∏π‡∏î‡∏¥‡∏ó</span></div>
        <div class="sample-item" data-name="‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Jirayu"><span>‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏</span></div>
        <div class="sample-item" data-name="‡∏õ‡∏±‡∏ç‡∏ç‡∏≤"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Panya"><span>‡∏õ‡∏±‡∏ç‡∏ç‡∏≤</span></div>
        <div class="sample-item" data-name="‡∏°‡∏ô‡∏±‡∏™‡∏™‡∏¥‡∏¢‡∏≤"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Manassiya"><span>‡∏°‡∏ô‡∏±‡∏™‡∏™‡∏¥‡∏¢‡∏≤</span></div>
        <div class="sample-item" data-name="‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Baitoey"><span>‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢</span></div>

        <div class="sample-item" data-name="‡πÄ‡∏ß‡∏¨‡∏≤"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Vela"><span>‡πÄ‡∏ß‡∏¨‡∏≤</span></div>
        <div class="sample-item" data-name="‡∏ß‡∏¥‡∏Å‡∏£‡∏°"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Vikrom"><span>‡∏ß‡∏¥‡∏Å‡∏£‡∏°</span></div>
        <div class="sample-item" data-name="‡∏≠‡∏±‡∏®‡∏ß‡πÇ‡∏†‡∏Ñ‡∏¥‡∏ô"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Assavaphokin"><span>‡∏≠‡∏±‡∏®‡∏ß‡πÇ‡∏†‡∏Ñ‡∏¥‡∏ô</span></div>
        <div class="sample-item" data-name="‡∏•‡∏≥‡πÑ‡∏¢"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Lamyai"><span>‡∏•‡∏≥‡πÑ‡∏¢</span></div>
        <div class="sample-item" data-name="‡πÄ‡∏™‡∏Å‡πÇ‡∏•‡πÇ‡∏ã"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=SekLoso"><span>‡πÄ‡∏™‡∏Å‡πÇ‡∏•‡πÇ‡∏ã</span></div>
        <div class="sample-item" data-name="‡∏ô‡∏¥‡∏ß‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Newclear"><span>‡∏ô‡∏¥‡∏ß‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</span></div>
    </div>
</div>

{{if .Error}}
    <div class="text-center text-danger mt-3" style="background: #ffebee; padding: 10px; border-radius: 5px;">
        ‚ö†Ô∏è {{.Error}}
    </div>
{{end}}

{{if .Result}}
    <div class="summary-box">
        <div class="summary-row">
            <div class="score-panel">
                <div class="score-item">
                    <div class="score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</div>
                    <div class="score-value-big {{if lt .Result.TotalScore 0}}bg-bad{{else}}bg-good{{end}}"
                         id="totalScore" data-target="{{.Result.TotalScore}}">0</div>
                </div>
                <div class="divider"></div>
                <div class="score-item">
                    <div class="score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ</div>
                    <div class="score-value-small val-good">+<span id="goodScore" data-target="{{.Result.GoodScore}}">0</span></div>
                </div>
                <div class="score-item">
                    <div class="score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡πâ‡∏≤‡∏¢</div>
                    <div class="score-value-small val-bad"><span id="badScore" data-target="{{.Result.BadScore}}">0</span></div>
                </div>
            </div>

            <div class="galaxy-wrapper">
                <div class="solar-system">
                    <div class="orbit-ring ring-middle">
                        {{range $i, $el := .Result.ShaPairs}}
                            {{if lt $i 5}}
                                <div class="planet-wrapper pos-mid-{{$i}}">
                                    <div class="mini-star {{if .Meaning}}type-{{.Meaning.PairType}}{{else}}star-sha{{end}} c-spin-middle"
                                         title="‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏á‡∏≤: {{.Pair}}">
                                        {{.Pair}}
                                    </div>
                                </div>
                            {{end}}
                        {{end}}
                    </div>
                    <div class="orbit-ring ring-outer">
                        {{range $i, $el := .Result.SatPairs}}
                            {{if lt $i 6}}
                                <div class="planet-wrapper pos-out-{{$i}}">
                                    <div class="mini-star {{if .Meaning}}type-{{.Meaning.PairType}}{{else}}star-sat{{end}} c-spin-outer"
                                         title="‡πÄ‡∏•‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå: {{.Pair}}">
                                        {{.Pair}}
                                    </div>
                                </div>
                            {{end}}
                        {{end}}
                    </div>
                    <div class="score-circle {{if lt .Result.TotalScore 0}}sun-bad{{else}}sun-good{{end}}">
                        <span id="sunNameDisplay">{{.Result.Name}}</span>
                    </div>
                </div>
            </div>

            <div class="right-column">
                <div class="kakis-box">
                    {{if .Result.HasKakis}}
                        <div style="color: #555; font-size: 0.9rem; background: rgba(255,255,255,0.9); padding: 8px 15px; border-radius: 20px; display: inline-block; border: 1px solid #ef9a9a; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                            <span style="color: #d32f2f;">‚óè</span> ‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è<span style="color: #d32f2f; font-weight: bold;">‡∏™‡∏µ‡πÅ‡∏î‡∏á</span>‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ
                        </div>
                    {{else}}
                        <div class="speech-bubble-success">üèÜ ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ</div>
                    {{end}}
                </div>
                <div class="action-frame">
                    <a href="#sat-section" class="btn-action btn-sat">üßÆ ‡πÄ‡∏•‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</a>
                    <a href="#sha-section" class="btn-action btn-lang">üìú ‡∏†‡∏≤‡∏©‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</a>
                    <div class="action-desc">üí° ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢</div>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 class="header-line">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢: {{.Result.Name}}</h2>
        <div class="result-container">
            <div class="result-col" id="sat-section">
                <h3 style="color: #0277bd;">üßÆ ‡πÄ‡∏•‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</h3>
                <p>‡∏ú‡∏•‡∏£‡∏ß‡∏°: <strong>{{.Result.SatSum}}</strong></p>
                {{range .Result.SatPairs}}
                    <div class="pair-card {{if .Meaning}}type-{{.Meaning.PairType}}{{end}}">
                        <div style="display: flex; align-items: flex-start;">
                            <div style="margin-right: 15px; text-align: center; min-width: 50px;">
                                <span class="pair-number">{{.Pair}}</span>
                                {{if .Meaning}}<br><span style="font-size: 0.8rem; padding: 2px 6px; background: #eee; border-radius: 4px; color: #666;">{{.Meaning.PairType}}</span>{{end}}
                            </div>
                            <div>
                                {{if .Meaning}}
                                    <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 5px;">{{.Meaning.MiracleDesc}}</div>
                                    <small style="color: #666; display: block; margin-bottom: 8px;">{{.Meaning.MiracleDetail}}</small>
                                    <span class="badge" style="background: rgba(0,0,0,0.05); color: #333; font-weight: bold;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: {{.Meaning.PairPoint}}</span>
                                {{else}}
                                    <span style="color: #999;">- ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ -</span>
                                {{end}}
                            </div>
                        </div>
                    </div>
                {{end}}
            </div>
            <div class="result-col" id="sha-section">
                <h3 style="color: #7b1fa2;">üåë ‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏á‡∏≤</h3>
                <p>‡∏ú‡∏•‡∏£‡∏ß‡∏°: <strong>{{.Result.ShaSum}}</strong></p>
                {{range .Result.ShaPairs}}
                    <div class="pair-card {{if .Meaning}}type-{{.Meaning.PairType}}{{end}}">
                        <div style="display: flex; align-items: flex-start;">
                            <div style="margin-right: 15px; text-align: center; min-width: 50px;">
                                <span class="pair-number">{{.Pair}}</span>
                                {{if .Meaning}}<br><span style="font-size: 0.8rem; padding: 2px 6px; background: #eee; border-radius: 4px; color: #666;">{{.Meaning.PairType}}</span>{{end}}
                            </div>
                            <div>
                                {{if .Meaning}}
                                    <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 5px;">{{.Meaning.MiracleDesc}}</div>
                                    <small style="color: #666; display: block; margin-bottom: 8px;">{{.Meaning.MiracleDetail}}</small>
                                    <span class="badge" style="background: rgba(0,0,0,0.05); color: #333; font-weight: bold;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: {{.Meaning.PairPoint}}</span>
                                {{else}}
                                    <span style="color: #999;">- ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ -</span>
                                {{end}}
                            </div>
                        </div>
                    </div>
                {{end}}
            </div>
        </div>
    </div>

    <div class="card">
        <h3 class="header-line">üåü ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏á‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á</h3>
        <div class="table-responsive">
            {{if .Result.SimilarNames}}
                <table class="table table-hover table-striped align-middle" style="margin-bottom: 0; width: 100%; border-collapse: collapse;">
                    <thead class="table-light">
                    <tr>
                        <th scope="col" style="padding: 12px;">‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏á‡∏Ñ‡∏•</th>
                        <th scope="col" class="text-center">‡πÄ‡∏•‡∏Ç‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</th>
                        <th scope="col" class="text-center">‡πÄ‡∏•‡∏Ç‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏á‡∏≤</th>
                        <th scope="col" class="text-center">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡πà‡∏≤‡∏á</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{range .Result.SimilarNames}}
                        <tr onclick="window.location.href='/analysis?name={{.ThName}}&birth_day={{$.BirthDay}}'">

                            <td style="font-size: 1.1rem; font-weight: bold; color: #333; padding: 12px;">{{.ThName}}</td>

                            <td class="text-center">
                                <div style="display: flex; justify-content: center; gap: 4px; flex-wrap: wrap;">
                                    {{range .SatPairs}}
                                        <div class="mini-star-table {{if .Meaning}}type-{{.Meaning.PairType}}{{else}}star-sat{{end}}"
                                             title="{{.Pair}} {{if .Meaning}}({{.Meaning.PairType}}){{end}}">
                                            {{.Pair}}
                                        </div>
                                    {{end}}
                                </div>
                            </td>

                            <td class="text-center">
                                <div style="display: flex; justify-content: center; gap: 4px; flex-wrap: wrap;">
                                    {{range .ShaPairs}}
                                        <div class="mini-star-table {{if .Meaning}}type-{{.Meaning.PairType}}{{else}}star-sha{{end}}"
                                             title="{{.Pair}} {{if .Meaning}}({{.Meaning.PairType}}){{end}}">
                                            {{.Pair}}
                                        </div>
                                    {{end}}
                                </div>
                            </td>

                            <td class="text-center">
                                <span style="font-size: 0.9rem; color: #666;">
                                    {{printf "%.3f" .Distance}}
                                </span>
                            </td>
                        </tr>
                    {{end}}
                    </tbody>
                </table>
            {{else}}
                <p class="text-center text-muted p-3">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
            {{end}}
        </div>
    </div>
{{end}}

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // --- Animation: Counters ---
        const counters = [
            document.getElementById('totalScore'),
            document.getElementById('goodScore'),
            document.getElementById('badScore')
        ];
        counters.forEach(counter => {
            if (!counter) return;
            const target = parseInt(counter.getAttribute('data-target'), 10) || 0;
            const duration = 2000;
            const start = 0;
            const startTime = performance.now();
            function updateCount(currentTime) {
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);
                const easeProgress = (progress === 1) ? 1 : 1 - Math.pow(2, -10 * progress);
                const current = Math.floor(easeProgress * (target - start) + start);
                counter.innerText = current;
                if (progress < 1) {
                    requestAnimationFrame(updateCount);
                } else {
                    counter.innerText = target;
                }
            }
            requestAnimationFrame(updateCount);
        });

        // --- Form Logic: Debounce Auto Submit & Clear Button ---
        const nameInput = document.getElementById('nameInput');
        const clearBtn = document.getElementById('clearInputBtn');
        const typingStatus = document.getElementById('typingStatus');

        let typingTimer;                // ‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡πá‡∏ö Timer
        const doneTypingInterval = 1500; // ‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏ô‡πà‡∏ß‡∏á 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (1500ms)

        if (nameInput && clearBtn) {
            const updateBtnState = () => {
                clearBtn.style.display = nameInput.value.length > 0 ? 'block' : 'none';
            };

            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î (User ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏™‡∏£‡πá‡∏à 1 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
            nameInput.addEventListener('keyup', function() {
                clearTimeout(typingTimer); // ‡∏•‡πâ‡∏≤‡∏á Timer ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á
                if (nameInput.value.trim()) {
                    typingStatus.style.display = 'block'; // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠..."
                    typingTimer = setTimeout(doneTyping, doneTypingInterval); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
                } else {
                    typingStatus.style.display = 'none';
                }
            });

            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡∏á‡πÑ‡∏õ (Reset Timer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á)
            nameInput.addEventListener('keydown', function() {
                clearTimeout(typingTimer);
                typingStatus.style.display = 'none';
            });

            // Logic ‡πÄ‡∏î‡∏¥‡∏° (Clean text & Clear button)
            nameInput.addEventListener('input', function() {
                let val = this.value;
                val = val.replace(/[^a-zA-Z\u0E00-\u0E7F\s]/g, '');
                val = val.replace(/\s{2,}/g, ' ');
                if (this.value !== val) {
                    this.value = val;
                }
                updateBtnState();
            });

            clearBtn.addEventListener('click', () => {
                nameInput.value = '';
                updateBtnState();
                nameInput.focus();
                typingStatus.style.display = 'none';
                clearTimeout(typingTimer);
            });
            updateBtnState();
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API (Submit Form) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏´‡∏°‡∏î
        function doneTyping() {
            typingStatus.innerText = 'üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...';
            document.querySelector('.analysis-form').submit();
        }

        // --- Highlight Kakis Characters ---
        const fullName = "{{if .Result}}{{.Result.Name}}{{end}}";
        const badChars = [{{if .Result}}{{range .Result.KakisFound}}"{{.}}",{{end}}{{end}}];
        function highlightText(elementId) {
            const el = document.getElementById(elementId);
            if (!el) return;
            let styledName = "";
            for (let char of fullName) {
                if (badChars.includes(char)) {
                    styledName += `<span style="color: #d32f2f; font-weight: 800; font-size: 1.2em; margin: 0 1px; text-shadow: 0 1px 2px rgba(0,0,0,0.1);">${char}</span>`;
                } else {
                    styledName += `<span>${char}</span>`;
                }
            }
            el.innerHTML = styledName;
        }
        highlightText('sunNameDisplay');

        // --- Sample Click Handler ---
        document.querySelectorAll('.sample-item').forEach(item => {
            item.addEventListener('click', function(e) {
                if(this.tagName === 'A' || this.closest('a')) return;
                const name = this.getAttribute('data-name');
                if(nameInput && name) {
                    nameInput.value = name;
                    // Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ü‡∏≠‡∏£‡πå‡∏°
                    document.querySelector('.card').scrollIntoView({behavior: 'smooth'});
                    // Trigger event ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö Auto Submit ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞ Submit ‡πÄ‡∏•‡∏¢‡∏Å‡πá‡πÑ‡∏î‡πâ)
                    // nameInput.dispatchEvent(new Event('keyup')); // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏ß‡∏á
                    // ‡∏´‡∏£‡∏∑‡∏≠ Submit ‡πÄ‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ:
                    document.querySelector('.analysis-form').submit();
                }
            });
        });
    });
</script>